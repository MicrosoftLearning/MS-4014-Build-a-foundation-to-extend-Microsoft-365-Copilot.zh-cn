# 练习实验室 1：为 Microsoft Graph 连接器配置连接

## WWL 租户 - 使用条款

如果在讲师引导式培训过程中向你提供租户，请注意，提供租户旨在支持讲师引导式培训中的动手实验室。

租户不应共享或用于动手实验室以外的用途。 本课程使用的租户为试用租户，课程结束后无法使用或访问，不符合扩展条件。

租户不得转换为付费订阅。 在本课程中获得的租户仍然是 Microsoft Corporation 的财产，我们保留随时获取访问权限和收回的权利。

## 总结

在此实验室中，你将使用 Microsoft 管理中心中的 Microsoft 文件共享连接器生成与客户文件的连接。

假设你是一家中型公司 Contoso 的客户服务经理。 在处理客户查询时，你的团队一直在努力应对响应时间和整体效率。 你决定利用 Microsoft 365 管理中心创建一个 FileShare 连接，使客户服务代理能够快速访问和引用客户文件。

## 练习 1：在Microsoft 365 管理中心配置连接

### 登录 VM

实验室托管提供商会为 MOD 管理员帐户（默认租户管理员）提供密码。 出于安全考虑，Microsoft 对试用版租户进行了配置，所有预定义的用户需要在下次登录时更改其密码。 以本地“Administrator”帐户身份登录到 LON-CL1，此帐户由实验室托管提供商创建，密码为 Pa55w.rd************。

### 任务 1：在Azure 门户中授予权限

1. 导航到 Azure 门户 **https://www.portal.azure.com**，然后使用管理凭据登录。 不要保存密码，然后对“**是否保持登录？**”选择“**是**”。
2. 在“**欢迎使用 Microsoft Azure**”的屏幕上，选择“**取消**”。
1. 选择屏幕左侧的下拉菜单图标以显示“门户”菜单。 选择“**Microsoft Entra ID -> 管理 -> 应用程序注册**”。
1. 从顶部菜单栏中，选择“**新建注册**”。 显示“**注册应用程序页**”。 在此页上，为应用命名；让我们将此应用命名为“**Contoso Fileshare命名**”。 将默认支持的账户类型选项保留为**仅限此组织目录中的帐户（仅限 Contoso - 单一租户）**。 不要选择可选的“**重定向 URI**”。
1. 选择“注册”。 应用程序已创建，并向其分配应用程序 ID。 在以下步骤中创建 Graph 连接器代理 (GCA) 时，将使用此信息。 但是，在创建 GCA 之前，让我们配置必要的设置。

下一步是在 Azure 门户中为 Graph 连接器代理授予权限：

1. 从左侧菜单中选择“**管理 -> API 权限**”。
1. 选择“**添加权限 -> Microsoft Graph ->应用程序权限**”，并允许对以下 API 的权限：

    - Directory -> Directory.Read.All
    - ExternalConnection -> ExternalConnection.ReadWrite.OwnedBy
    - ExternalItem -> ExternalItem.ReadWrite.All
      
1. 选择“添加权限”按钮。
1. 选择“**授予 Contoso 的管理员同意**”，然后选择“**是**”进行确认。

**备注：** 不要关闭此 Edge 浏览器选项卡。以下任务要求从Azure 门户复制和粘贴信息。

### 任务 2：安装 GCA

1. 打开新的 Microsoft Edge 浏览器选项卡。导航到以下 URL 以下载 Graph 连接器代理：**https://www.microsoft.com/en-us/download/details.aspx?id=104045** 选择“下载”按钮。 
1. 打开 **GcaInstaller_3.1.1.0.msi** 文件，并按照安装向导中的提示进行操作。 
2. 在屏幕底部的“**搜索**”栏中，输入“**Graph 连接器代理配置**”，并在显示应用时从菜单中选择该应用。
3. 选择“**是**”，允许应用对设备进行更改。
4. 使用 **MOD 管理员**帐户登录并注册 GCA。 身份验证已完成的确认将显示在 Edge 浏览器中。 你可以关闭此窗口。
5. 通过选择屏幕底部的图标打开 GCA 应用。
1. 将此代理命名为 **ContosoFiles**。
1. 选择 Azure 门户 Microsoft Edge 选项卡（应读取 **Contoso Fileshare - Microsoft Azure**），导航到 **“概述**”屏幕并复制**应用程序（客户端）ID**。 将其粘贴到 GCA 安装应用中。

接下来，需要在 Azure 门户中为此应用设置客户端密码。

1. 返回到“Azure 门户”边缘选项卡并导航到“**证书和机密**”。
1. 选择 **+ 新客户端密码**。 通过输入“**Contoso 文件**”添加“**说明**”。 可以将过期字段设置为默认的 180 天。
2. 选择 **添加** 。
3. 复制无提示机密的“**值**”字段。
1. 返回到 Graph 连接器代理应用，并将该值粘贴到 **GCA 安装程序应用的应用程序密码（客户端密码）** 字段中。
1. 选择“注册”。
1. 注册完成后，关闭安装程序应用。

### 任务 3：从 Github 下载资源文件

若要使用 GCA 配置连接器，需要系统本地文件。 

1. 打开一个新的 Microsoft Edge 浏览器，在地址栏中输入 **https://github.com/MicrosoftLearning/MS-4014-Build-a-foundation-to-extend-Microsoft-365-Copilot/tree/master/ResourceFiles**。
2. 选择文件夹中的第一个文件，**Contoso Chai Tea market trends 2023.xls**，将其打开。
3. 选择 **屏幕右上角的省略号（更多文件操作）** 按钮，然后选择“**下载**”。
4. 对其余每个文件重复步骤 3。
5. 下载完成后，可以关闭此窗口。
6. 使用文件资源管理器并导航到 C:\ directory。 创建名为 **ResourceFiles** 的新文件夹。
7. 打开新的文件资源管理器窗口，导航到“**下载**”文件夹以访问从 GitHub 下载的 Contoso 文件。 将这些文件复制到 **C:\ResourceFiles** 目录中。

你将使用这些文件作为在 Microsoft 管理中心创建的连接的源内容。

### 任务 4：打开 Microsoft 365 管理中心

1. 打开新的 Microsoft Edge 浏览器标签页。在 Microsoft Edge 浏览器中，在地址栏中输入以下 URL 转到“**Microsoft 365 主页**”页面：**https://portal.office.com**
1. 如果系统提示你登录，请输入实验室托管提供商为 Microsoft 365 试用租户提供的 LON-CL1 **用户名**和**密码**。 用户名应采用 **<admin@xxxxxZZZZZZ.onmicrosoft.com>** 格式，其中 xxxxxZZZZZZ 是实验室托管提供商分配的租户前缀。 
1. “**欢迎使用 Microsoft 365**”页面显示在 Microsoft Edge 浏览器的“**主页 | Microsoft 365**”标签页中。这是 MOD 管理员的 Microsoft 365 主页。
1. 在导航窗格中显示的应用程序图标列表中，选择“**管理员**”，随即会在新浏览器标签页中打开 **Microsoft 365 管理中心**。
1. 选择“**...显示全部**”以显示完整导航菜单。 选择“**设置**” -> “**搜索和智能**”。
1. 在显示的 **“概述**”选项卡上，向下滚动。 从“**连接器**”框中选择“**添加第一个连接**”。

在此处列出可用数据源的列表。 我们正在使用文件共享连接器配置连接。 此连接器允许 Microsoft 365 Copilot 搜索来引用 Copilot 搜索中的客户文件，并允许在客户服务代理查找答案时更快地响应时间和更准确的响应。

1. 选择“**文件共享**”，然后选择“**下一步**”。
1. 输入“**显示名称**”。 显示名称是向用户显示的唯一名称。 让我们在字段中输入“**Contoso 文件**”。
1. 输入**文件夹路径。** 我们在以下目录中配置了示例文件：

   **C:\ResourceFiles**

此路径是存储文件的目录。

1. 在“**Graph 连接器代理**”字段中，选择前面步骤 (ContosoFiles) 中创建的 GCA（如果不是默认选项）。
1. 选择 **Windows** 作为身份验证类型，然后输入 Windows 身份验证的 LON-CLI **用户名**和**密码**。
1. 选中复选框以授权 Microsoft 在租户中创建第三方数据的索引。
1. 选择**创建**。  此时会显示一个成功屏幕，连接开始同步。可以在“**连接器说明**”框中输入特定类型的内容、可能受益于其使用的组织部门或工作流示例。 例如：

    **此连接器包含本地文件共享服务器中包含的信息。包括客户档案和客户问题，这些问题可能会使支持人员在回答客户查询方面受益。**
1. 选择“完成”。**** 连接现在显示在 Microsoft 365 管理中心的“**搜索和智能**”标签页上，可以在搜索结果中引用，也可以在生成 Microsoft 365 Copilot 代理时引用。
